<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalisVerse - Professional Equipment Store | Auto-Deploy Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
    <script src="https://threejs.org/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://threejs.org/examples/js/loaders/DRACOLoader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    
    <!-- Enhanced Cart Styles -->
    <link rel="stylesheet" href="./css/enhanced-cart-styles.css">
    <link rel="stylesheet" href="./css/professional-cart-styles.css">
    <link rel="stylesheet" href="./css/color-picker-styles.css">
    <link rel="stylesheet" href="./css/checkout-styles.css">
    <link rel="stylesheet" href="./css/notification-styles.css">
    <link rel="stylesheet" href="./css/premium-glass-cards.css">
    <link rel="stylesheet" href="./css/variant-controls.css">
    <link rel="stylesheet" href="css/premium-model-viewer.css">
    <link rel="stylesheet" href="css/premium-animated-background.css">
    <link rel="stylesheet" href="css/email-capture.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0a0a0f;
            --secondary: #1a1a2e;
            --accent: #8B5CF6;
            --accent-light: #a855f7;
            --text: #ffffff;
            --text-secondary: #a0aec0;
            --text-muted: #718096;
        }

        html {
            scroll-behavior: smooth;
            scroll-snap-type: y mandatory;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0f;
            color: white;
            overflow-x: hidden;
            scroll-behavior: smooth;
            position: relative;
        }
        
        /* Premium Igloo animated background handled by igloo-animated-background.js */
        
        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Fixed Navigation */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
            padding: 20px 40px;
            transition: all 0.3s ease;
        }

        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 28px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 40px;
            align-items: center;
        }

        .nav-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-links a:hover {
            color: var(--accent);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--accent);
            transition: width 0.3s ease;
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .shop-now-btn {
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        
        .shop-now-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        /* Hero Section */
        .hero {
            height: 100vh;
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .hero-content {
            max-width: 800px;
            z-index: 2;
        }

        .hero h1 {
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 900;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--text) 0%, var(--accent) 50%, var(--accent-light) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.1;
        }

        .hero p {
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            color: rgba(255, 255, 255, 0.8);
            max-width: 700px;
            margin: 0 auto 40px;
            line-height: 1.6;
        }
        
        .hero-trust-signals {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            margin-top: 40px;
            opacity: 0.9;
        }
        
        .trust-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }
        
        .trust-icon {
            font-size: 1.2rem;
        }
        
        @media (max-width: 768px) {
            .hero-trust-signals {
                gap: 20px;
            }
            
            .trust-item {
                font-size: 0.85rem;
            }
        }

        .scroll-indicator {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        .scroll-arrow {
            width: 2px;
            height: 40px;
            background: linear-gradient(to bottom, var(--accent), transparent);
            margin-top: 10px;
            animation: scrollPulse 2s infinite;
        }

        @keyframes scrollPulse {
            0%, 100% { opacity: 0.3; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(10px); }
        }

        /* Viewer Overlay Styling */
        .viewer-overlay {
            pointer-events: none;
        }
        
        .color-swatch {
            pointer-events: auto;
        }
        
        /* Product Specifications Styling */
        .product-specs {
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }
        
        .spec-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .spec-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        
        .spec-label {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .spec-value {
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* Customer Testimonial Styling */
        .product-testimonial {
            margin: 25px 0;
            padding: 20px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 12px;
            border-left: 4px solid var(--accent);
        }
        
        .testimonial-content p {
            color: rgba(255, 255, 255, 0.9);
            font-style: italic;
            margin: 10px 0;
            line-height: 1.5;
        }
        
        .testimonial-stars {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }
        
        .testimonial-author {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
            margin-top: 12px;
        }
        
        .testimonial-author strong {
            color: white;
        }
        
        /* Product Sections */
        .product-section {
            width: 100vw;
            min-height: 100vh;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 80px 0;
            backdrop-filter: blur(0.5px);
        }
        
        /* Section Content */
        .section-content {
            max-width: 1200px;
            width: 100%;
            padding: 0 40px;
        }
        
        /* Equipment Overview */
        .equipment-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 40px;
            margin-top: 60px;
        }
        
        .equipment-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .equipment-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .equipment-card h3 {
            color: var(--accent);
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        .equipment-card p {
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .equipment-card .price {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
        }
        
        /* About Section */
        .about-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 80px;
            margin-top: 60px;
        }
        
        .about-text h2 {
            color: var(--accent);
            font-size: 2rem;
            margin-bottom: 30px;
        }
        
        .about-text p {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.8;
            margin-bottom: 20px;
        }
        
        /* Contact Section */
        .contact-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 80px;
            margin-top: 60px;
        }
        
        .contact-form h2,
        .contact-info h3 {
            color: var(--accent);
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            color: white;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
        }
        
        .contact-info p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 20px;
        }
        
        /* Cart Icon */
        .cart-icon {
            position: relative;
            cursor: pointer;
            padding: 12px;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: white;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .cart-icon:hover {
            background: rgba(139, 92, 246, 0.3);
            transform: scale(1.08) translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
            border-color: rgba(139, 92, 246, 0.5);
        }
        
        .cart-icon:active {
            transform: scale(1.02) translateY(0px);
            transition: all 0.1s ease;
        }
        
        .cart-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: scale(0);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .cart-badge.show {
            transform: scale(1);
        }
        
        /* Professional Checkout Styles */
        .checkout-progress {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px;
            background: rgba(139, 92, 246, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-number {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            border-color: #8b5cf6;
            color: white;
        }

        .progress-step.completed .step-number {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .step-label {
            margin-top: 8px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .progress-step.active .step-label {
            color: white;
        }

        .progress-line {
            width: 80px;
            height: 2px;
            background: rgba(255, 255, 255, 0.2);
            margin: 0 20px;
            transition: all 0.3s ease;
        }

        .progress-line.completed {
            background: #10b981;
        }

        .checkout-step-content {
            padding: 40px;
            max-width: 600px;
            margin: 0 auto;
        }

        .order-items {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .order-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .item-image {
            font-size: 2rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 10px;
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .item-variant {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        .item-quantity {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 8px;
        }

        .item-quantity button {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .item-quantity button:hover {
            background: rgba(139, 92, 246, 0.3);
        }

        .item-price {
            color: #8b5cf6;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .remove-item {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .remove-item:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .order-totals {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }

        .total-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .total-line.grand-total {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 12px;
            margin-top: 12px;
        }

        .free-shipping {
            color: #10b981;
            font-weight: 600;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h4 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group label {
            display: block;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #8b5cf6;
            background: rgba(255, 255, 255, 0.08);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 30px;
        }

        .payment-option {
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .payment-option.active {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }

        .payment-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .payment-header label {
            color: white;
            font-weight: 600;
            flex: 1;
        }

        .card-icons {
            display: flex;
            gap: 8px;
        }

        .security-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            padding: 20px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 12px;
        }

        .security-badge {
            color: #10b981;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .checkout-actions {
            display: flex;
            gap: 20px;
            justify-content: space-between;
            padding: 30px 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.3);
        }

        .order-confirmation {
            text-align: center;
            padding: 60px 40px;
            max-width: 500px;
            margin: 0 auto;
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .order-confirmation h2 {
            color: white;
            margin-bottom: 16px;
            font-size: 2rem;
        }

        .order-confirmation p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .order-details {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .order-number {
            font-size: 1.3rem;
            color: #8b5cf6;
            margin-bottom: 20px;
        }

        .order-info p {
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Professional Cart Modal - Sliding from Right */
        .cart-overlay {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: rgba(0, 0, 0, 0.6) !important;
            backdrop-filter: blur(12px);
            z-index: 10000 !important;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .cart-overlay.active {
            opacity: 1 !important;
            visibility: visible !important;
            pointer-events: all !important;
        }

        .cart-modal {
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            max-width: 480px;
            height: 100vh;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.98) 0%, rgba(16, 16, 32, 0.98) 100%);
            backdrop-filter: blur(25px);
            border-left: 1px solid rgba(139, 92, 246, 0.2);
            box-shadow: -10px 0 40px rgba(0, 0, 0, 0.3);
            transform: translateX(100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .cart-overlay.active .cart-modal {
            transform: translateX(0);
        }

        @media (max-width: 768px) {
            .cart-modal {
                max-width: 100%;
                width: 100%;
            }
        }
        
        .cart-overlay.active .cart-modal {
            transform: translateX(0) !important;
        }
        
        .cart-header {
            padding: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .cart-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            margin: 0;
        }
        
        .cart-close {
            position: absolute;
            top: 30px;
            right: 30px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }
        
        .cart-close:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .cart-content {
            padding: 0;
        }
        
        .cart-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.3);
            padding: 20px 30px;
            margin: 0;
            color: #10b981;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .cart-item {
            padding: 25px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .cart-item-thumbnail {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(168, 85, 247, 0.15));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            flex-shrink: 0;
            border: 1px solid rgba(139, 92, 246, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .quantity-btn:hover {
            background: rgba(139, 92, 246, 0.3);
            border-color: var(--accent);
        }
        
        .quantity-display {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
            color: white;
        }
        
        .cart-empty {
            padding: 60px 30px;
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .cart-empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .cart-footer {
            padding: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(168, 85, 247, 0.05) 100%);
            backdrop-filter: blur(10px);
        }

        .cart-subtotal {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .cart-subtotal span:last-child {
            background: linear-gradient(135deg, #ffffff 0%, #a855f7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .cart-actions {
            display: flex;
            gap: 12px;
            flex-direction: column;
        }

        .cart-btn-primary, .cart-btn-secondary {
            padding: 16px 24px;
            border-radius: 14px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .cart-btn-primary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .cart-btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(139, 92, 246, 0.5);
            background: linear-gradient(135deg, #9333ea 0%, #a855f7 100%);
        }

        .cart-btn-secondary {
            background: rgba(255, 255, 255, 0.06);
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
        }

        .cart-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.12);
            color: white;
        }
        
        /* Mini Cart Preview */
        .mini-cart {
            position: absolute;
            top: 100%;
            right: 0;
            width: 320px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            transform: translateY(10px) scale(0.95);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 1000;
            backdrop-filter: blur(20px);
        }
        
        .cart-icon:hover .mini-cart {
            transform: translateY(0) scale(1);
            opacity: 1;
            visibility: visible;
        }
        
        .mini-cart-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-weight: 600;
            color: white;
        }
        
        .mini-cart-items {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .mini-cart-item {
            padding: 15px 20px;
            display: flex;
            gap: 12px;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .mini-cart-item:last-child {
            border-bottom: none;
        }
        
        .mini-cart-image {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(168, 85, 247, 0.2));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .mini-cart-details {
            flex: 1;
        }
        
        .mini-cart-name {
            font-size: 0.9rem;
            color: white;
            margin-bottom: 2px;
        }
        
        .mini-cart-price {
            font-size: 0.8rem;
            color: var(--accent);
            font-weight: 600;
        }
        
        .mini-cart-footer {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .mini-cart-total {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-weight: 600;
            color: white;
        }
        
        .mini-cart-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--accent), #a855f7);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mini-cart-btn:hover {
            transform: translateY(-1px);
        }
        
        /* Checkout Modal Styles */
        .checkout-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 15000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .checkout-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .checkout-modal {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
        
        .checkout-summary h3,
        .checkout-form h3 {
            color: var(--accent);
            margin-bottom: 25px;
            font-size: 1.3rem;
        }
        
        .checkout-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .checkout-item-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .checkout-item-emoji {
            font-size: 1.5rem;
        }
        
        .checkout-item-name {
            color: white;
            font-weight: 600;
        }
        
        .checkout-item-variant {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }
        
        .checkout-item-price {
            text-align: right;
        }
        
        .checkout-quantity {
            color: rgba(255, 255, 255, 0.6);
            margin-right: 10px;
        }
        
        .checkout-price {
            color: var(--accent);
            font-weight: 600;
        }
        
        .checkout-total {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .total-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .final-total {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .checkout-form .form-group {
            margin-bottom: 20px;
        }
        
        .checkout-form label {
            display: block;
            color: white;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .checkout-form input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .checkout-form input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
        }
        
        .checkout-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--accent), #a855f7);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }
        
        .checkout-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .cart-modal {
                width: 100vw;
                right: 0;
            }
            
            .mini-cart {
                width: 280px;
                right: -20px;
            }
            
            .checkout-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        .section-title {
            font-size: 3rem;
            font-weight: 900;
            color: white;
            text-align: center;
            margin-bottom: 60px;
            grid-column: 1 / -1;
        }
        
        /* Equipment Grid */
        .equipment-grid {
            max-width: 1400px;
            width: 100%;
            display: grid;
            grid-template-columns: 1fr;
            gap: 60px;
            padding: 0 40px;
        }
        
        .equipment-item {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 80vh;
            align-items: center;
        }

        .product-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: grid;
            grid-template-columns: 1fr 1fr;
            align-items: center;
            gap: 0;
        }

        .product-3d-container {
            width: 100%;
            height: 100vh;
            position: relative;
            overflow: hidden;
            cursor: grab;
            background: #ffffff;
            border: 2px solid rgba(139, 92, 246, 0.2);
            box-shadow: inset 0 0 50px rgba(139, 92, 246, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px;
        }

        .product-3d-container:active {
            cursor: grabbing;
        }

        .product-3d-container canvas {
            display: block !important;
            width: calc(100% - 120px) !important;
            height: calc(100% - 120px) !important;
            position: absolute !important;
            top: 60px !important;
            left: 60px !important;
            z-index: 1 !important;
            pointer-events: auto !important;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        /* Ensure scroll works everywhere except on 3D canvas when hovered */
        body {
            overflow-x: hidden;
            overflow-y: auto;
        }

        .product-info {
            width: 100%;
            height: 100vh;
            padding: 80px 60px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            z-index: 10;
        }

        .product-category {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
        }

        .product-title {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 900;
            margin-bottom: 30px;
            line-height: 1.1;
        }

        .product-description {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 40px;
            line-height: 1.7;
        }

        .product-features {
            margin-bottom: 50px;
        }

        .feature {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            font-size: 1rem;
            color: var(--text-secondary);
        }

        .feature-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--accent);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .product-price {
            font-size: 3rem;
            font-weight: 900;
            color: var(--accent);
            margin-bottom: 30px;
        }

        .product-actions {
            display: flex;
            gap: 20px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text);
            padding: 18px 40px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-secondary:hover {
            border-color: var(--accent);
            background: rgba(139, 92, 246, 0.1);
        }

        /* Alternating Layout */
        .product-section:nth-child(odd) .product-container {
            grid-template-columns: 1fr 1fr;
        }
        
        .product-section:nth-child(even) .product-container {
            grid-template-columns: 1fr 1fr;
        }
        
        .product-section:nth-child(odd) .product-info {
            order: 1;
            border-left: none;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .product-section:nth-child(odd) .product-3d-container {
            order: 2;
        }


        /* Section-specific background overlays */
        .product-section:nth-child(2) {
            background: radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.05) 0%, transparent 70%);
        }

        .product-section:nth-child(3) {
            background: radial-gradient(circle at 80% 50%, rgba(59, 130, 246, 0.05) 0%, transparent 70%);
        }
        
        .product-section:nth-child(4) {
            background: radial-gradient(circle at 50% 50%, rgba(6, 182, 212, 0.05) 0%, transparent 70%);
        }

        /* 3D Controls Hint */
        .controls-hint {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 0.9rem;
            opacity: 0;
            z-index: 10;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .product-3d-container:hover .controls-hint {
            opacity: 0.8;
        }
        
        /* Scroll overlay to ensure smooth scrolling */
        .scroll-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: auto;
            background: transparent;
        }
        
        .product-3d-container:hover .scroll-overlay {
            pointer-events: none;
        }

        /* Loading State */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--accent);
            font-size: 1.2rem;
            font-weight: 600;
        }

        /* Color Customization Bar */
        .color-bar {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            background: rgba(0, 0, 0, 0.9);
            padding: 16px 24px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .add-to-cart-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            z-index: 15;
            opacity: 0;
        }
        
        .add-to-cart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.6);
            background: linear-gradient(135deg, #a855f7 0%, #c084fc 100%);
        }
        
        .add-to-cart-btn:active {
            transform: scale(0.98);
        }
        
        .product-3d-container:hover .add-to-cart-btn {
            opacity: 1;
        }

        .product-3d-container:hover .color-bar {
            opacity: 1;
        }

        .color-swatch {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .color-swatch[data-color="0x444444"] {
            background: #444444;
        }
        
        .color-swatch[data-color="0x8b4513"] {
            background: #8b4513;
        }
        
        .color-swatch[data-color="0x2c2c2c"] {
            background: #2c2c2c;
        }
        
        .color-swatch[data-color="0xc0c0c0"] {
            background: #c0c0c0;
        }
        
        .color-swatch[data-color="0x8b5cf6"] {
            background: #8b5cf6;
        }

        .color-swatch:hover {
            transform: scale(1.15);
            border-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 20px rgba(255, 255, 255, 0.1);
        }

        .color-swatch.active {
            transform: scale(1.1);
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        .color-swatch::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .color-swatch:hover::after {
            width: 100%;
            height: 100%;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .product-container {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr 1fr;
            }
            
            .product-3d-container {
                height: 50vh;
                padding: 30px;
                border: 1px solid rgba(139, 92, 246, 0.2);
            }
            
            .product-3d-container canvas {
                width: calc(100% - 60px) !important;
                height: calc(100% - 60px) !important;
                top: 30px !important;
                left: 30px !important;
            }
            
            .product-section:nth-child(odd) .product-info {
                order: 1;
                border-left: none;
                border-right: 1px solid rgba(255, 255, 255, 0.1);
            }
        
            .product-section:nth-child(odd) .product-3d-container {
                order: 2;
            }


            /* Section-specific background overlays */
            .product-section:nth-child(2) {
                background: radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.05) 0%, transparent 70%);
            }

            .product-section:nth-child(3) {
                background: radial-gradient(circle at 80% 50%, rgba(59, 130, 246, 0.05) 0%, transparent 70%);
            }
        
            .product-section:nth-child(4) {
                background: radial-gradient(circle at 50% 50%, rgba(6, 182, 212, 0.05) 0%, transparent 70%);
            }

            /* 3D Controls Hint */
            .controls-hint {
                position: absolute;
                bottom: 20px;
                left: 20px;
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 12px 16px;
                border-radius: 10px;
                font-size: 0.9rem;
                opacity: 0;
                z-index: 10;
                transition: opacity 0.3s ease;
                pointer-events: none;
            }
        
            .product-3d-container:hover .controls-hint {
                opacity: 0.8;
            }
        
            /* Scroll overlay to ensure smooth scrolling */
            .scroll-overlay {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 5;
                pointer-events: auto;
                background: transparent;
            }
        
            .product-3d-container:hover .scroll-overlay {
                pointer-events: none;
            }

            /* Loading State */
            .loading {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: var(--accent);
                font-size: 1.2rem;
                font-weight: 600;
            }

            /* Color Customization Bar */
            .color-bar {
                position: absolute;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                gap: 12px;
                background: rgba(0, 0, 0, 0.9);
                padding: 16px 24px;
                border-radius: 50px;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(139, 92, 246, 0.3);
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                z-index: 10;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
        
            .add-to-cart-btn {
                position: absolute;
                top: 50%;
                right: 40px;
                transform: translateY(-50%);
                background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);
                color: white;
                border: none;
                padding: 16px 32px;
                border-radius: 50px;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
                backdrop-filter: blur(10px);
                transition: all 0.3s ease;
                z-index: 15;
                opacity: 0;
            }
        
            .add-to-cart-btn:hover {
                transform: translateY(-50%) scale(1.05);
                box-shadow: 0 15px 40px rgba(139, 92, 246, 0.6);
                background: linear-gradient(135deg, #a855f7 0%, #c084fc 100%);
            }
        
            .add-to-cart-btn:active {
                transform: translateY(-50%) scale(0.98);
            }
        
            .product-3d-container:hover .add-to-cart-btn {
                opacity: 1;
            }

            .product-3d-container:hover .color-bar {
                opacity: 1;
            }

            .color-swatch {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                cursor: pointer;
                border: 2px solid rgba(255, 255, 255, 0.2);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
            }

            .color-swatch:hover {
                transform: scale(1.15);
                border-color: rgba(255, 255, 255, 0.8);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 20px rgba(255, 255, 255, 0.1);
            }

            .color-swatch.active {
                transform: scale(1.1);
                border-color: var(--accent);
                box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
            }

            .color-swatch::after {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 50%;
                transform: translate(-50%, -50%);
                transition: all 0.3s ease;
            }

            .color-swatch:hover::after {
                width: 100%;
                height: 100%;
            }

            /* Responsive Design */
            @media (max-width: 1024px) {
                .product-container {
                    grid-template-columns: 1fr;
                    grid-template-rows: 1fr 1fr;
                }
            
                .product-3d-container {
                    height: 50vh;
                    padding: 30px;
                    border: 1px solid rgba(139, 92, 246, 0.2);
                }
            
                .product-3d-container canvas {
                    width: calc(100% - 60px) !important;
                    height: calc(100% - 60px) !important;
                    top: 30px !important;
                    left: 30px !important;
                }
            
                .product-info {
                    height: 50vh;
                    padding: 40px 30px;
                    border-left: none;
                    border-right: none;
                    border-top: 1px solid rgba(255, 255, 255, 0.1);
                }
            
                .product-section:nth-child(odd) .product-info {
                    order: 2;
                    border-right: none;
                    border-top: 1px solid rgba(255, 255, 255, 0.1);
                }
            
                .product-section:nth-child(odd) .product-3d-container {
                    order: 1;
                }

                .nav-links {
                    display: none;
                }
            }

            @media (max-width: 768px) {
                .nav {
                    padding: 15px 20px;
                }

                .product-info {
                    padding: 30px 20px;
                }

                .product-title {
                    font-size: 2rem;
                }

                .product-price {
                    font-size: 2rem;
                }
            
                .color-bar {
                    bottom: 50px;
                    padding: 12px 16px;
                    gap: 8px;
                }
            
                .color-swatch {
                    width: 32px;
                    height: 32px;
                }
            
                .product-3d-container {
                    padding: 20px;
                }
            
                .product-3d-container canvas {
                    width: calc(100% - 40px) !important;
                    height: calc(100% - 40px) !important;
                    top: 20px !important;
                    left: 20px !important;
                }
            }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-background"></div>
    <div class="particles" id="particles"></div>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-brand">
            <span class="brand-text">CalisVerse</span>
        </div>
        <div class="nav-links">
            <a href="#home">Home</a>
            <a href="#pullup-section">Pull-Up Bars</a>
            <a href="#rings-section">Rings</a>
            <a href="#parallettes-section">Parallettes</a>
            <a href="#about">About</a>
            <a class="shop-now-btn" href="#equipment">Shop Now</a>
            <div class="cart-icon" id="cart-icon" onclick="showCartModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="m1 1 4 4 5.5 11h8.5a2 2 0 0 0 2-1.732l1.732-3a2 2 0 0 0-1.732-3H9.5"></path>
                </svg>
                <span class="cart-badge" id="cart-badge">0</span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="hero-content">
            <h1>Transform Your Home Into an Elite Training Facility</h1>
            <p>Build championship-level strength with equipment trusted by Olympic athletes and professional trainers worldwide. Experience our premium 3D configurator and discover why thousands choose CalisVerse for their fitness transformation.</p>
            
            <!-- Trust Signals -->
            <div class="hero-trust-signals">
                <div class="trust-item">
                    <span class="trust-icon"></span>
                    <span>4.9/5 from 2,847 athletes</span>
                </div>
                <div class="trust-item">
                    <span class="trust-icon"></span>
                    <span>Used by Olympic teams</span>
                </div>
                <div class="trust-item">
                    <span class="trust-icon"></span>
                    <span>Free shipping worldwide</span>
                </div>
                <div class="trust-item">
                    <span class="trust-icon"></span>
                    <span>30-day money-back guarantee</span>
                </div>
            </div>
        </div>
        <div class="scroll-indicator">
            <span>Scroll to explore</span>
            <div class="scroll-arrow"></div>
        </div>
    </section>

    <!-- Pull-Up Bar Section -->
    <section class="product-section" id="pullup-section">
        <div class="product-container">
            <div class="product-3d-container" id="pullup-viewer">
                <model-viewer
                    src="/models/pullup-bar.glb"
                    camera-controls
                    touch-action="pan-y"
                    interaction-prompt="auto"
                    shadow-intensity="0.6"
                    exposure="1.0"
                    environment-image="neutral"
                    poster="/images/pullup-bar-poster.jpg"
                    style="width:100%;height:520px;border-radius:16px;background:#0b0b0f;">
                </model-viewer>
                <div class="loading-text viewer-overlay">Loading 3D Model...</div>
                <div class="color-bar viewer-overlay">
                    <div class="color-swatch matte-black" data-color="0x1A1A1A" title="Matte Black"></div>
                    <div class="color-swatch gunmetal-gray" data-color="0x2C3539" title="Gunmetal Gray"></div>
                    <div class="color-swatch steel-silver" data-color="0xC0C0C0" title="Steel Silver"></div>
                    <div class="color-swatch walnut-brown" data-color="0x8B4513" title="Walnut Brown"></div>
                    <div class="color-swatch bronze" data-color="0xCD7F32" title="Bronze"></div>
                </div>
            </div>
            <div class="controls-hint">Hover to interact  Click & Drag to Rotate  Scroll to Zoom</div>
            <div class="product-info">
                <div class="product-category">Pull-Up Equipment</div>
                <h2 class="product-title">Elite Wall-Mounted Pull-Up Bar</h2>
                <p class="product-description">
                    Transform your home gym with professional-grade equipment trusted by Olympic training facilities. 
                    Military-spec steel construction with powder-coated finish resists 500+ hours of salt spray testing. 
                    Ergonomic multi-grip design targets different muscle groups while reducing joint stress.
                </p>
                
                <!-- Technical Specifications -->
                <div class="product-specs">
                    <div class="spec-grid">
                        <div class="spec-item">
                            <span class="spec-label">Weight Capacity:</span>
                            <span class="spec-value">350 lbs (159 kg)</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Dimensions:</span>
                            <span class="spec-value">48" W  12" D  8" H</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Material:</span>
                            <span class="spec-value">14-gauge steel, powder-coated</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Warranty:</span>
                            <span class="spec-value">Lifetime structural guarantee</span>
                        </div>
                    </div>
                </div>
                <div class="product-features">
                    <div class="feature">
                        <div class="feature-icon"></div>
                        <span>Used by 12+ Olympic training centers</span>
                    </div>
                    <div class="feature">
                        <div class="feature-icon"></div>
                        <span>Multi-grip design: wide, narrow, neutral</span>
                    </div>
                    <div class="feature">
                        <div class="feature-icon"></div>
                        <span>15-minute installation with included hardware</span>
                    </div>
                    <div class="feature">
                        <div class="feature-icon"></div>
                        <span>Lifetime warranty + 30-day trial</span>
                    </div>
                </div>
                
                <!-- Customer Testimonial -->
                <div class="product-testimonial">
                    <div class="testimonial-content">
                        <div class="testimonial-stars"></div>
                        <p>"Installed this 6 months ago - still rock solid. My max pull-ups went from 8 to 15. Worth every penny."</p>
                        <div class="testimonial-author">
                            <strong>Marcus Chen</strong> - CrossFit Level 2 Trainer
                        </div>
                    </div>
                </div>
                <div class="product-price">$299.99</div>
                <div class="product-actions">
                    <button class="btn-primary" onclick="addToCart('pullup')">Add to Cart</button>
                    <button class="btn-secondary">Learn More</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Gymnastics Rings Section -->
    <section class="product-section" id="rings-section">
        <div class="product-container">
            <div class="product-info">
                <div class="product-category">Ring Training</div>
                <h2 class="product-title">Wooden Gymnastics Rings</h2>
                <p class="product-description">
                    Premium birch wood rings with competition-grade specifications. Adjustable straps with cam buckles 
                    for quick height changes. Natural wood provides superior grip even when hands are sweaty.
                </p>
                <div class="product-features">
                    <div class="feature">
                        <div class="feature-icon"></div>
                        <span>Premium birch wood construction</span>
                    </div>
                    <div class="feature">
                        <div class="feature-icon"></div>
                        <span>Adjustable 15ft straps included</span>
                    </div>
                    <div class="feature">
                        <div class="feature-icon"></div>
                        <span>Competition regulation size</span>
                    </div>
                    <div class="feature">
                        <div class="feature-icon"></div>
                        <span>Natural anti-slip surface</span>
                    </div>
                </div>
                <div class="product-price">$149.99</div>
                <div class="product-actions">
                    <button class="btn-primary" onclick="addToCart('rings')">Add to Cart</button>
                    <button class="btn-secondary">Learn More</button>
                </div>
            </div>
            <div class="product-3d-container" id="rings-viewer">
                <model-viewer
                    src="/models/rings.glb"
                    camera-controls
                    touch-action="pan-y"
                    interaction-prompt="auto"
                    shadow-intensity="0.6"
                    exposure="1.0"
                    environment-image="neutral"
                    poster="/images/rings-poster.jpg"
                    style="width:100%;height:520px;border-radius:16px;background:#0b0b0f;">
                </model-viewer>
                <div class="loading-text viewer-overlay">Loading 3D Model...</div>
                <div class="color-bar viewer-overlay">
                    <div class="color-swatch matte-black" data-color="0x1A1A1A" title="Matte Black"></div>
                    <div class="color-swatch gunmetal-gray" data-color="0x2C3539" title="Gunmetal Gray"></div>
                    <div class="color-swatch steel-silver" data-color="0xC0C0C0" title="Steel Silver"></div>
                    <div class="color-swatch walnut-brown" data-color="0x8B4513" title="Walnut Brown"></div>
                    <div class="color-swatch bronze" data-color="0xCD7F32" title="Bronze"></div>
                </div>
            </div>
            <div class="scroll-overlay"></div>
            <div class="controls-hint">Hover to interact  Click & Drag to Rotate  Scroll to Zoom</div>
        </div>
    </section>

    <!-- Parallettes Section -->
    <section class="product-section" id="parallettes-section">
        <div class="product-container">
            <div class="product-3d-container" id="parallettes-viewer">
                <model-viewer
                    src="/models/parallettes.glb"
                    camera-controls
                    touch-action="pan-y"
                    interaction-prompt="auto"
                    shadow-intensity="0.6"
                    exposure="1.0"
                    environment-image="neutral"
                    poster="/images/parallettes-poster.jpg"
                    style="width:100%;height:520px;border-radius:16px;background:#0b0b0f;">
                </model-viewer>
                <div class="loading-text viewer-overlay">Loading 3D Model...</div>
                <div class="color-bar viewer-overlay">
                    <div class="color-swatch matte-black" data-color="0x1A1A1A" title="Matte Black"></div>
                    <div class="color-swatch gunmetal-gray" data-color="0x2C3539" title="Gunmetal Gray"></div>
                    <div class="color-swatch chrome-silver" data-color="0xE8E8E8" title="Chrome Silver"></div>
                    <div class="color-swatch purple" data-color="0x8B5CF6" title="Purple"></div>
                    <div class="color-swatch white" data-color="0xF8F8F8" title="White"></div>
                    <div class="color-swatch bronze" data-color="0xCD7F32" title="Bronze"></div>
                </div>
            </div>
            <div class="product-info">
                <div class="product-category">Floor Training</div>
                <h2 class="product-title">Wooden Parallettes</h2>
                <p class="product-description">
                    Handcrafted wooden parallettes perfect for L-sits, handstands, and push-up variations. 
                    Premium birch wood construction with ergonomic grip design for maximum comfort during extended training sessions.
                </p>
                <div class="product-features">
                    <div class="feature">
                        <span>Premium birch wood construction</span>
                    </div>
                    <div class="feature">
                        <span>Ergonomic grip design</span>
                    </div>
                    <div class="feature">
                        <span>Non-slip rubber base</span>
                    </div>
                    <div class="feature">
                        <span>Supports up to 300lbs</span>
                    </div>
                </div>
                <div class="product-price">$89.99</div>
                <div class="product-actions">
                    <button class="btn-primary" onclick="addToCart('parallettes')">Add to Cart</button>
                    <button class="btn-secondary">Learn More</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Equipment Section -->
    <section class="product-section" id="equipment">
        <div class="section-content">
            <h1 class="section-title">Professional Equipment</h1>
            <div class="equipment-overview">
                <div class="equipment-card">
                    <h3>Pull-Up Bars</h3>
                    <p>Heavy-duty steel construction with reinforced brackets. Perfect for building upper body strength.</p>
                    <div class="price">$299.99</div>
                    <button class="btn-primary" onclick="scrollToSection('pullup-section')">View 3D Model</button>
                </div>
                <div class="equipment-card">
                    <h3>Gymnastic Rings</h3>
                    <p>Olympic-standard rings with adjustable straps. Professional-grade equipment for muscle-ups.</p>
                    <div class="price">$149.99</div>
                    <button class="btn-primary" onclick="scrollToSection('rings-section')">View 3D Model</button>
                </div>
                <div class="equipment-card">
                    <h3>Parallettes</h3>
                    <p>Handcrafted wooden parallettes for L-sits and handstands. Ergonomic design with non-slip base.</p>
                    <div class="price">$89.99</div>
                    <button class="btn-primary" onclick="scrollToSection('parallettes-section')">View 3D Model</button>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="product-section" id="about">
        <div class="section-content">
            <h1 class="section-title">About CalisVerse</h1>
            <div class="about-grid">
                <div class="about-text">
                    <h2>Our Story</h2>
                    <p>Founded in 2020 by professional athletes and fitness enthusiasts, CalisVerse emerged from a simple belief: calisthenics equipment should be as beautiful as it is functional.</p>
                    <p>We started in a small workshop, handcrafting parallettes and pull-up bars for local gyms. Today, we serve thousands of athletes worldwide, from beginners to Olympic gymnasts.</p>
                </div>
                <div class="about-text">
                    <h2>Our Mission</h2>
                    <p>To democratize access to professional-grade calisthenics equipment, making strength training accessible to everyone, everywhere.</p>
                    <p>We believe that with the right tools, anyone can unlock their physical potential and achieve their fitness goals.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="product-section" id="contact">
        <div class="section-content">
            <h1 class="section-title">Get In Touch</h1>
            <div class="contact-grid">
                <div class="contact-form">
                    <h2>Send us a message</h2>
                    <form onsubmit="handleFormSubmit(event)">
                        <div class="form-group">
                            <label for="name">Name</label>
                            <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="message">Message</label>
                            <textarea id="message" name="message" rows="5" required></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Send Message</button>
                    </form>
                </div>
                <div class="contact-info">
                    <h3>Contact Information</h3>
                    <p><strong>Address:</strong><br>1234 Fitness Street<br>San Francisco, CA 94102</p>
                    <p><strong>Phone:</strong> +1 (555) 123-4567</p>
                    <p><strong>Email:</strong> hello@calisverse.com</p>
                    <p><strong>Hours:</strong><br>Mon-Fri: 9AM-6PM PST<br>Sat: 10AM-4PM PST</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Cart Modal -->
    <div class="cart-overlay" id="cart-overlay" onclick="closeCart(event)">
        <div class="cart-modal" onclick="event.stopPropagation()">
            <div class="cart-header">
                <h2>Shopping Cart</h2>
                <button class="cart-close" onclick="closeCart()">&times;</button>
            </div>
            
            <div class="cart-success" id="cart-success" style="display: none;">
                <span></span>
                <span>Successfully added to cart!</span>
            </div>
            
            <div class="cart-content" id="cart-content">
                <div class="cart-empty" id="cart-empty">
                    <div class="cart-empty-icon"></div>
                    <h3>Your cart is empty</h3>
                    <p>Discover our premium calisthenics equipment and start building your perfect workout setup.</p>
                </div>
                <div class="cart-items" id="cart-items" style="display: none;"></div>
            </div>
            
            <div class="cart-footer" id="cart-footer" style="display: none;">
                <div class="cart-subtotal">
                    <span>Subtotal:</span>
                    <span id="cart-subtotal">$0.00</span>
                </div>
                <div class="cart-actions">
                    <button class="cart-btn-primary" id="checkout-btn" onclick="showCheckout()">View Cart & Checkout</button>
                    <button class="cart-btn-secondary" onclick="closeCart()">Continue Shopping</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Mini Cart Preview -->
    <div class="mini-cart" id="mini-cart">
        <div class="mini-cart-header">Cart Preview</div>
        <div class="mini-cart-items" id="mini-cart-items">
            <div style="padding: 20px; text-align: center; color: rgba(255,255,255,0.6); font-size: 0.9rem;">
                No items in cart
            </div>
        </div>
        <div class="mini-cart-footer" id="mini-cart-footer" style="display: none;">
            <div class="mini-cart-total">
                <span>Total:</span>
                <span id="mini-cart-total">$0.00</span>
            </div>
            <button class="mini-cart-btn" onclick="openCart()">View Cart</button>
        </div>
    </div>
    
    <script>
        // 3D Scene Management
        class ThreeDViewer {
            constructor(containerId) {
                this.containerId = containerId;
                this.container = document.getElementById(containerId);
                if (!this.container) {
                    console.error('Container not found:', containerId);
                    return null;
                }
                
                console.log('Container found:', this.container);
                console.log('Container client dimensions:', this.container.clientWidth, 'x', this.container.clientHeight);
                console.log('Container offset dimensions:', this.container.offsetWidth, 'x', this.container.offsetHeight);
                
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.product = null;
                this.isMouseDown = false;
                this.mouseX = 0;
                this.mouseY = 0;
                this.rotationX = 0;
                this.rotationY = 0;
                this.currentMaterial = null;
                
                // Force container to have dimensions if needed
                if (this.container.clientWidth === 0 || this.container.clientHeight === 0) {
                    console.log('Container has no dimensions, setting minimum size');
                    this.container.style.width = '100vw';
                    this.container.style.height = '100vh';
                    this.container.style.minWidth = '800px';
                    this.container.style.minHeight = '600px';
                }
                
                this.init();
                this.setupColorCustomization();
            }

            init() {
                console.log('Initializing ThreeDViewer for:', this.containerId);
                
                // Scene setup
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0xf8f9fa);
                
                // Add subtle camera drift for immersive feel
                this.cameraOffset = { x: 0, y: 0 };
                this.targetOffset = { x: 0, y: 0 };
                console.log('Scene created');

                // Camera setup with dramatic angle (inspired by motorcycle reference)
                this.camera = new THREE.PerspectiveCamera(
                    45,
                    this.container.clientWidth / this.container.clientHeight,
                    0.1,
                    1000
                );
                this.camera.position.set(3, 1.5, 4);
                this.camera.lookAt(0, 0, 0);
                console.log('Camera created and positioned');

                // Renderer setup with enhanced settings
                this.renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: true,
                    powerPreference: "high-performance"
                });
                this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                this.renderer.outputColorSpace = THREE.SRGBColorSpace;
                this.renderer.toneMapping = THREE.ACESFilmicToneMapping;
                this.renderer.toneMappingExposure = 1.2;
                
                // Ensure canvas is visible
                this.renderer.domElement.style.display = 'block';
                this.renderer.domElement.style.position = 'absolute';
                this.renderer.domElement.style.top = '0';
                this.renderer.domElement.style.left = '0';
                this.renderer.domElement.style.width = '100%';
                this.renderer.domElement.style.height = '100%';
                this.renderer.domElement.style.zIndex = '1';
                
                this.container.appendChild(this.renderer.domElement);
                console.log('Renderer created and added to DOM with dimensions:', this.container.clientWidth, 'x', this.container.clientHeight);

                // Add mouse controls for interaction
                this.addMouseControls();

                // Setup lighting and environment
                this.setupLighting();
                console.log('Lighting setup complete');
                
                // Start animation loop
                this.animate();
                this.setupCameraDrift();
                console.log('Animation loop started');
                
                // Handle window resize
                window.addEventListener('resize', () => this.onWindowResize());
                
                console.log('ThreeDViewer initialization complete for:', this.containerId);
            }

            setupColorCustomization() {
                const colorBar = this.container.querySelector('.color-bar');
                if (!colorBar) return;

                const swatches = colorBar.querySelectorAll('.color-swatch');
                swatches.forEach(swatch => {
                    swatch.addEventListener('click', (e) => {
                        // Remove active class from all swatches
                        swatches.forEach(s => s.classList.remove('active'));
                        // Add active class to clicked swatch
                        swatch.classList.add('active');
                        
                        // Get the color value
                        const colorValue = parseInt(swatch.dataset.color);
                        this.changeProductColor(colorValue);
                    });
                });
            }

            changeProductColor(colorValue) {
                if (!this.product || !this.currentMaterial) return;

                // Smooth color transition
                const targetColor = new THREE.Color(colorValue);
                const startColor = this.currentMaterial.color.clone();
                
                let progress = 0;
                const animate = () => {
                    progress += 0.05;
                    if (progress <= 1) {
                        this.currentMaterial.color.lerpColors(startColor, targetColor, progress);
                        requestAnimationFrame(animate);
                    } else {
                        this.currentMaterial.color.copy(targetColor);
                    }
                };
                animate();
            }

            setupLighting() {
                console.log('Setting up enhanced lighting...');
                
                // Professional studio lighting setup
                const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
                this.scene.add(ambientLight);

                // Key light (main light source) - stronger and more focused
                const keyLight = new THREE.DirectionalLight(0xffffff, 2.0);
                keyLight.position.set(8, 10, 6);
                keyLight.castShadow = true;
                keyLight.shadow.mapSize.width = 4096;
                keyLight.shadow.mapSize.height = 4096;
                keyLight.shadow.camera.near = 0.1;
                keyLight.shadow.camera.far = 50;
                keyLight.shadow.bias = -0.0001;
                keyLight.shadow.camera.left = -10;
                keyLight.shadow.camera.right = 10;
                keyLight.shadow.camera.top = 10;
                keyLight.shadow.camera.bottom = -10;
                this.scene.add(keyLight);

                // Fill light (softer, opposite side) - cooler tone
                const fillLight = new THREE.DirectionalLight(0x87ceeb, 0.8);
                fillLight.position.set(-6, 6, 4);
                this.scene.add(fillLight);

                // Rim light (for edge definition) - warmer tone
                const rimLight = new THREE.DirectionalLight(0xfff8dc, 0.6);
                rimLight.position.set(0, 3, -8);
                this.scene.add(rimLight);
                
                // Additional accent light from below
                const accentLight = new THREE.DirectionalLight(0x8b5cf6, 0.3);
                accentLight.position.set(0, -2, 5);
                this.scene.add(accentLight);
                
                console.log('Enhanced lighting setup complete');
            }

            createPullUpBar() {
                console.log('Creating pull-up bar...');
                const group = new THREE.Group();

                // Main horizontal bar
                const barGeometry = new THREE.CylinderGeometry(0.03, 0.03, 1.2, 32);
                this.currentMaterial = new THREE.MeshStandardMaterial({
                    color: 0x444444,
                    metalness: 0.8,
                    roughness: 0.2
                });
                const bar = new THREE.Mesh(barGeometry, this.currentMaterial);
                bar.rotation.z = Math.PI / 2;
                bar.castShadow = true;
                bar.receiveShadow = true;
                group.add(bar);

                // Support brackets
                for (let i = -0.5; i <= 0.5; i += 1) {
                    const bracketGeometry = new THREE.BoxGeometry(0.12, 0.35, 0.06);
                    const bracket = new THREE.Mesh(bracketGeometry, this.currentMaterial);
                    bracket.position.set(i, -0.15, 0);
                    bracket.castShadow = true;
                    bracket.receiveShadow = true;
                    group.add(bracket);
                }

                // Simple floor
                const floorGeometry = new THREE.PlaneGeometry(3, 3);
                const floorMaterial = new THREE.MeshStandardMaterial({
                    color: 0x222222,
                    roughness: 0.8
                });
                const floor = new THREE.Mesh(floorGeometry, floorMaterial);
                floor.rotation.x = -Math.PI / 2;
                floor.position.y = -0.5;
                floor.receiveShadow = true;
                group.add(floor);

                group.position.y = 0;
                this.scene.add(group);
                this.product = group;
                console.log('Pull-up bar added to scene');
            }

            createRings() {
                console.log('Creating rings...');
                const group = new THREE.Group();

                // Wood material for rings
                this.currentMaterial = new THREE.MeshStandardMaterial({
                    color: 0x5D4037,
                    roughness: 0.6,
                    metalness: 0.05
                });

                // Create two gymnastic rings
                for (let i = -0.3; i <= 0.3; i += 0.6) {
                    const ringGeometry = new THREE.TorusGeometry(0.12, 0.02, 16, 100);
                    const ring = new THREE.Mesh(ringGeometry, this.currentMaterial);
                    ring.position.set(i, 0, 0);
                    ring.castShadow = true;
                    ring.receiveShadow = true;
                    group.add(ring);

                    // Straps
                    const strapGeometry = new THREE.CylinderGeometry(0.008, 0.008, 1.5, 8);
                    const strapMaterial = new THREE.MeshStandardMaterial({
                        color: 0x2c2c2c,
                        roughness: 0.8
                    });
                    const strap = new THREE.Mesh(strapGeometry, strapMaterial);
                    strap.position.set(i, 0.75, 0);
                    strap.castShadow = true;
                    group.add(strap);
                }

                // Floor
                const floorGeometry = new THREE.PlaneGeometry(2, 2);
                const floorMaterial = new THREE.MeshStandardMaterial({
                    color: 0x222222,
                    roughness: 0.8
                });
                const floor = new THREE.Mesh(floorGeometry, floorMaterial);
                floor.rotation.x = -Math.PI / 2;
                floor.position.y = -0.8;
                floor.receiveShadow = true;
                group.add(floor);

                this.scene.add(group);
                this.product = group;
                console.log('Rings added to scene');
            }

            createParallettes() {
                console.log('Creating parallettes...');
                const group = new THREE.Group();

                // Wood material for handles
                this.currentMaterial = new THREE.MeshStandardMaterial({
                    color: 0x8D6E63,
                    roughness: 0.7
                });

                // Create pair of parallettes
                for (let i = -0.25; i <= 0.25; i += 0.5) {
                    const parallette = new THREE.Group();

                    // Handle
                    const handleGeometry = new THREE.CylinderGeometry(0.025, 0.025, 0.35, 16);
                    const handle = new THREE.Mesh(handleGeometry, this.currentMaterial);
                    handle.rotation.z = Math.PI / 2;
                    handle.position.y = 0.12;
                    handle.castShadow = true;
                    handle.receiveShadow = true;
                    parallette.add(handle);

                    // Legs
                    for (let j = -0.1; j <= 0.1; j += 0.2) {
                        const legGeometry = new THREE.CylinderGeometry(0.018, 0.018, 0.12, 12);
                        const leg = new THREE.Mesh(legGeometry, this.currentMaterial);
                        leg.position.set(j, 0.06, 0);
                        leg.castShadow = true;
                        leg.receiveShadow = true;
                        parallette.add(leg);

                        // Rubber feet
                        const footGeometry = new THREE.CylinderGeometry(0.025, 0.025, 0.008, 12);
                        const footMaterial = new THREE.MeshStandardMaterial({
                            color: 0x0a0a0a,
                            roughness: 0.9
                        });
                        const foot = new THREE.Mesh(footGeometry, footMaterial);
                        foot.position.set(j, 0.004, 0);
                        parallette.add(foot);
                    }

                    parallette.position.set(i, 0, 0);
                    group.add(parallette);
                }

                // Floor
                const floorGeometry = new THREE.PlaneGeometry(2, 2);
                const floorMaterial = new THREE.MeshStandardMaterial({
                    color: 0x222222,
                    roughness: 0.8
                });
                const floor = new THREE.Mesh(floorGeometry, floorMaterial);
                floor.rotation.x = -Math.PI / 2;
                floor.position.y = -0.01;
                floor.receiveShadow = true;
                group.add(floor);

                this.scene.add(group);
                this.product = group;
                console.log('Parallettes added to scene');
            }

            addMouseControls() {
                this.isMouseDown = false;
                this.previousMousePosition = { x: 0, y: 0 };

                this.onMouseDown = (event) => {
                    this.isMouseDown = true;
                    this.previousMousePosition = {
                        x: event.clientX,
                        y: event.clientY
                    };
                    event.preventDefault();
                };

                this.onMouseMove = (event) => {
                    if (!this.isMouseDown) return;

                    const deltaMove = {
                        x: event.clientX - this.previousMousePosition.x,
                        y: event.clientY - this.previousMousePosition.y
                    };

                    if (this.product) {
                        this.product.rotation.y += deltaMove.x * 0.01;
                        this.product.rotation.x += deltaMove.y * 0.01;
                    }

                    this.previousMousePosition = {
                        x: event.clientX,
                        y: event.clientY
                    };
                    event.preventDefault();
                };

                this.onMouseUp = () => {
                    this.isMouseDown = false;
                };

                this.onWheel = (event) => {
                    event.preventDefault();
                    const scale = event.deltaY > 0 ? 1.1 : 0.9;
                    if (this.camera.position.z * scale > 2 && this.camera.position.z * scale < 15) {
                        this.camera.position.multiplyScalar(scale);
                    }
                };

                // Add event listeners to canvas
                const canvas = this.renderer.domElement;
                canvas.addEventListener('mousedown', this.onMouseDown, { passive: false });
                canvas.addEventListener('mousemove', this.onMouseMove, { passive: false });
                canvas.addEventListener('mouseup', this.onMouseUp);
                canvas.addEventListener('wheel', this.onWheel, { passive: false });
                
                // Also add to document for mouse up outside canvas
                document.addEventListener('mouseup', this.onMouseUp);
            }

            setupCameraDrift() {
                // Subtle camera movement based on mouse position
                document.addEventListener('mousemove', (e) => {
                    if (this.container.matches(':hover')) {
                        const rect = this.container.getBoundingClientRect();
                        const x = (e.clientX - rect.left) / rect.width - 0.5;
                        const y = (e.clientY - rect.top) / rect.height - 0.5;
                        
                        this.targetOffset.x = x * 0.2;
                        this.targetOffset.y = -y * 0.2;
                    }
                });
            }
            
            animate() {
                requestAnimationFrame(() => this.animate());
                
                // Smooth camera drift
                this.cameraOffset.x += (this.targetOffset.x - this.cameraOffset.x) * 0.05;
                this.cameraOffset.y += (this.targetOffset.y - this.cameraOffset.y) * 0.05;
                
                if (this.camera) {
                    this.camera.position.x = 3 + this.cameraOffset.x;
                    this.camera.position.y = 1.5 + this.cameraOffset.y;
                    this.camera.lookAt(0, 0, 0);
                }
                
                if (this.renderer && this.scene && this.camera) {
                    this.renderer.render(this.scene, this.camera);
                }
            }

            onWindowResize() {
                this.camera.aspect = this.container.clientWidth / this.container.clientHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
            }
        }

        // Test WebGL support first
        function testWebGL() {
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (gl) {
                console.log('WebGL supported:', gl.getParameter(gl.RENDERER));
                return true;
            } else {
                console.error('WebGL not supported in this browser');
                return false;
            }
        }

        // Initialize 3D viewers when page loads
        function initializeViewers() {
            console.log('Starting 3D viewer initialization...');
            
            // Test WebGL first
            if (!testWebGL()) {
                document.querySelectorAll('.loading').forEach(el => {
                    el.innerHTML = 'WebGL not supported in your browser';
                    el.style.color = 'red';
                });
                return;
            }
            
            // Check if THREE.js is loaded with fallback
            if (typeof THREE === 'undefined') {
                console.error('THREE.js not loaded from CDN, trying fallback...');
                
                // Try loading from different CDN
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js';
                script.onload = () => {
                    console.log('THREE.js loaded from fallback CDN');
                    setTimeout(initializeViewers, 100);
                };
                script.onerror = () => {
                    console.error('All CDN sources failed');
                    document.querySelectorAll('.loading').forEach(el => {
                        el.innerHTML = 'THREE.js blocked by browser - Please disable shields for this site';
                        el.style.color = 'red';
                        el.style.fontSize = '14px';
                    });
                };
                document.head.appendChild(script);
                return;
            }
            console.log('THREE.js loaded successfully, version:', THREE.REVISION);
            
            // Hide all loading messages immediately
            document.querySelectorAll('.loading').forEach(el => {
                el.style.display = 'none';
            });
            
            // Create all 3D viewers
            setTimeout(() => {
                try {
                    console.log('Creating pull-up bar viewer...');
                    const pullupViewer = new ThreeDViewer('pullup-viewer');
                    if (pullupViewer && pullupViewer.renderer) {
                        pullupViewer.createPullUpBar();
                        console.log('Pull-up bar viewer created successfully');
                    }

                    console.log('Creating rings viewer...');
                    const ringsViewer = new ThreeDViewer('rings-viewer');
                    if (ringsViewer && ringsViewer.renderer) {
                        ringsViewer.createRings();
                        console.log('Rings viewer created successfully');
                    }

                    console.log('Creating parallettes viewer...');
                    const parallettesViewer = new ThreeDViewer('parallettes-viewer');
                    if (parallettesViewer && parallettesViewer.renderer) {
                        parallettesViewer.createParallettes();
                        console.log('Parallettes viewer created successfully');
                    }

                    console.log('All 3D viewers created successfully');
                    
                } catch (error) {
                    console.error('Initialization error:', error);
                    console.error('Stack:', error.stack);
                }
            }, 100);
        }

        // Shopping Cart System
        let cart = JSON.parse(sessionStorage.getItem('calisverse_cart')) || [];
        let cartCount = parseInt(sessionStorage.getItem('calisverse_cart_count')) || 0;
        let cartTotal = parseFloat(sessionStorage.getItem('calisverse_cart_total')) || 0;
        
        // Product data
        const products = {
            'parallettes': {
                name: 'Wooden Parallettes',
                price: 89.99,
                emoji: '',
                category: 'Floor Training'
            },
            'rings': {
                name: 'Gymnastic Rings',
                price: 149.99,
                emoji: '',
                category: 'Suspension Training'
            },
            'pullup': {
                name: 'Pull-Up Bar',
                price: 299.99,
                emoji: '',
                category: 'Upper Body'
            }
        };
        
        // Debug function to check if cart system is working
        function debugCart() {
            console.log('Cart system loaded');
            console.log('Available products:', Object.keys(products));
        }
        
        // Add to cart functionality
        function addToCart(productId) {
            console.log('Adding to cart:', productId);
            const product = products[productId];
            if (!product) {
                console.error('Product not found:', productId);
                console.log('Available products:', Object.keys(products));
                return;
            }
            
            // Add visual feedback to button
            const button = event?.target?.closest('.btn-primary') || document.querySelector(`button[onclick*="${productId}"]`);
            if (button) {
                const originalText = button.innerHTML;
                
                button.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                button.innerHTML = ' Added to Cart!';
                
                setTimeout(() => {
                    button.style.background = 'linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)';
                    button.innerHTML = originalText;
                }, 2000);
            }
            
            // Add to cart with proper state management
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: product.name,
                    price: product.price,
                    emoji: product.emoji,
                    quantity: 1,
                    variant: 'Standard'
                });
            }
            
            // Update counters
            cartCount = cart.reduce((total, item) => total + item.quantity, 0);
            cartTotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            
            // Save to session storage
            sessionStorage.setItem('calisverse_cart', JSON.stringify(cart));
            sessionStorage.setItem('calisverse_cart_count', cartCount.toString());
            sessionStorage.setItem('calisverse_cart_total', cartTotal.toString());
            
            // Update cart UI immediately
            updateCartUI();
            
            // Show success notification
            showSuccessNotification(`${product.name} added to cart!`);
            
            console.log('Cart updated:', { cartCount, cartTotal, cart });
            
        }
        
        // Success notification function
        function showSuccessNotification(message) {
            // Remove any existing notifications
            const existingNotification = document.querySelector('.success-notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'success-notification';
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-icon"></span>
                    <span class="notification-text">${message}</span>
                </div>
            `;
            
            // Add styles
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
                padding: 16px 24px;
                border-radius: 12px;
                box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
                z-index: 15000;
                transform: translateX(100%);
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            `;
            
            // Add to DOM
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 400);
            }, 3000);
        }
        
        // Update cart UI with proper state management - delegate to fixed cart system
        function updateCartUI() {
            // Update badge only
            const badge = document.getElementById('cart-badge');
            if (badge) {
                const currentCount = parseInt(badge.textContent) || 0;
                badge.textContent = cartCount;
                badge.classList.toggle('show', cartCount > 0);
                
                // Add bounce animation if count increased
                if (cartCount > currentCount) {
                    badge.style.transform = 'scale(1.3)';
                    setTimeout(() => {
                        badge.style.transform = 'scale(1)';
                    }, 200);
                }
            }
            
            // Delegate cart modal rendering to fixed cart system
            if (window.fixedCartSystem) {
                window.fixedCartSystem.updateCartDisplay();
            }
            
            console.log('UI updated - Badge:', cartCount, 'Total:', cartTotal);
        }

        // Render cart items - removed to avoid conflicts with fixed cart system
        
        // Update mini cart
        function updateMiniCart() {
            const miniCartItems = document.getElementById('mini-cart-items');
            const miniCartFooter = document.getElementById('mini-cart-footer');
            const miniCartTotal = document.getElementById('mini-cart-total');
            
            if (cart.length === 0) {
                miniCartItems.innerHTML = '<div style="padding: 20px; text-align: center; color: rgba(255,255,255,0.6); font-size: 0.9rem;">No items in cart</div>';
                miniCartFooter.style.display = 'none';
                return;
            }
            
            miniCartFooter.style.display = 'block';
            miniCartTotal.textContent = `$${cartTotal.toFixed(2)}`;
            
            const miniCartHTML = cart.slice(0, 3).map(item => `
                <div class="mini-cart-item">
                    <div class="mini-cart-image">${item.emoji}</div>
                    <div class="mini-cart-details">
                        <div class="mini-cart-name">${item.name}</div>
                        <div class="mini-cart-price">$${item.price.toFixed(2)}  ${item.quantity}</div>
                    </div>
                </div>
            `).join('');
            
            miniCartItems.innerHTML = miniCartHTML + (cart.length > 3 ? `<div style="padding: 10px 20px; text-align: center; color: rgba(255,255,255,0.6); font-size: 0.8rem;">+${cart.length - 3} more items</div>` : '');
        }
        
        // Update quantity
        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (!item) return;
            
            item.quantity += change;
            
            if (item.quantity <= 0) {
                cart = cart.filter(item => item.id !== productId);
            }
            
            sessionStorage.setItem('calisverse_cart', JSON.stringify(cart));
            updateCartUI();
        }
        
        // Show cart modal
        function showCartModal() {
            console.log('Attempting to show cart modal...');
            const overlay = document.getElementById('cart-overlay');
            if (!overlay) {
                console.error('Cart overlay element not found!');
                return;
            }
            console.log('Adding active class to overlay');
            overlay.classList.add('active');
            // Force reflow to ensure the animation triggers
            overlay.offsetHeight;
        }
        
        // Close cart modal
        function closeCart(event) {
            if (event && event.target !== event.currentTarget) return;
            const overlay = document.getElementById('cart-overlay');
            overlay.classList.remove('active');
            hideSuccessMessage();
        }
        
        // Open cart modal
        function openCart() {
            showCartModal();
        }
        
        // Show success message
        function showSuccessMessage() {
            const success = document.getElementById('cart-success');
            success.style.display = 'flex';
            
            setTimeout(() => {
                hideSuccessMessage();
            }, 3000);
        }
        
        // Hide success message
        function hideSuccessMessage() {
            const success = document.getElementById('cart-success');
            success.style.display = 'none';
        }
        
        // Professional multi-step checkout system
        let checkoutStep = 1;
        let checkoutData = {
            billing: {},
            shipping: {},
            payment: {},
            sameAsShipping: true
        };

        // View cart and checkout functionality
        function viewCart() {
            console.log('ViewCart function called, cartTotal:', cartTotal);
            console.log('Cart contents:', cart);
            
            // Check if cart has items
            if (cart.length === 0) {
                alert('Your cart is empty. Please add some items first.');
                return;
            }
            
            // Reset checkout step
            checkoutStep = 1;
            
            // Remove any existing checkout modal
            const existingModal = document.querySelector('.checkout-overlay');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Create professional checkout modal
            const checkoutModal = document.createElement('div');
            checkoutModal.className = 'checkout-overlay';
            checkoutModal.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.85) !important;
                backdrop-filter: blur(15px);
                z-index: 15000 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            `;
            
            checkoutModal.innerHTML = getCheckoutStepHTML();
            
            document.body.appendChild(checkoutModal);
            
            // Show modal with animation
            setTimeout(() => {
                checkoutModal.style.opacity = '1';
            }, 10);
        }

        // Get HTML for current checkout step
        function getCheckoutStepHTML() {
            const progressBar = `
                <div class="checkout-progress">
                    <div class="progress-step ${checkoutStep >= 1 ? 'active' : ''} ${checkoutStep > 1 ? 'completed' : ''}">
                        <div class="step-number">1</div>
                        <div class="step-label">Order Summary</div>
                    </div>
                    <div class="progress-line ${checkoutStep > 1 ? 'completed' : ''}"></div>
                    <div class="progress-step ${checkoutStep >= 2 ? 'active' : ''} ${checkoutStep > 2 ? 'completed' : ''}">
                        <div class="step-number">2</div>
                        <div class="step-label">Information</div>
                    </div>
                    <div class="progress-line ${checkoutStep > 2 ? 'completed' : ''}"></div>
                    <div class="progress-step ${checkoutStep >= 3 ? 'active' : ''}">
                        <div class="step-number">3</div>
                        <div class="step-label">Payment</div>
                    </div>
                </div>
            `;

            if (checkoutStep === 1) {
                return `
                    <div class="checkout-modal">
                        <div class="checkout-header">
                            <h2>Secure Checkout</h2>
                            <button class="checkout-close" onclick="closeCheckout()">&times;</button>
                        </div>
                        ${progressBar}
                        <div class="checkout-content">
                            <div class="checkout-step-content">
                                <h3>Order Summary</h3>
                                <div class="order-items">
                                    ${cart.map(item => `
                                        <div class="order-item">
                                            <div class="item-image">${getProductEmoji(item.id)}</div>
                                            <div class="item-details">
                                                <div class="item-name">${item.name}</div>
                                                <div class="item-variant">${item.variant}</div>
                                            </div>
                                            <div class="item-quantity">
                                                <button onclick="updateCheckoutQuantity('${item.id}', ${item.quantity - 1})"></button>
                                                <span>${item.quantity}</span>
                                                <button onclick="updateCheckoutQuantity('${item.id}', ${item.quantity + 1})">+</button>
                                            </div>
                                            <div class="item-price">$${(item.price * item.quantity).toFixed(2)}</div>
                                            <button class="remove-item" onclick="removeCheckoutItem('${item.id}')"></button>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="order-totals">
                                    <div class="total-line">
                                        <span>Subtotal:</span>
                                        <span>$${cartTotal.toFixed(2)}</span>
                                    </div>
                                    <div class="total-line">
                                        <span>Shipping:</span>
                                        <span class="free-shipping">Free</span>
                                    </div>
                                    <div class="total-line">
                                        <span>Tax:</span>
                                        <span>$${(cartTotal * 0.08).toFixed(2)}</span>
                                    </div>
                                    <div class="total-line grand-total">
                                        <span>Total:</span>
                                        <span>$${(cartTotal * 1.08).toFixed(2)}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="checkout-actions">
                                <button class="btn-secondary" onclick="closeCheckout()">Continue Shopping</button>
                                <button class="btn-primary" onclick="nextCheckoutStep()">Continue to Information</button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (checkoutStep === 2) {
                return `
                    <div class="checkout-modal">
                        <div class="checkout-header">
                            <h2>Customer Information</h2>
                            <button class="checkout-close" onclick="closeCheckout()">&times;</button>
                        </div>
                        ${progressBar}
                        <div class="checkout-content">
                            <div class="checkout-step-content">
                                <form id="customer-form">
                                    <div class="form-section">
                                        <h4>Contact Information</h4>
                                        <div class="form-group">
                                            <label>Email Address</label>
                                            <input type="email" name="email" required placeholder="your@email.com">
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>First Name</label>
                                                <input type="text" name="firstName" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Last Name</label>
                                                <input type="text" name="lastName" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Phone Number</label>
                                            <input type="tel" name="phone" required placeholder="(555) 123-4567">
                                        </div>
                                    </div>
                                    
                                    <div class="form-section">
                                        <h4>Billing Address</h4>
                                        <div class="form-group">
                                            <label>Street Address</label>
                                            <input type="text" name="billingAddress" required>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>City</label>
                                                <input type="text" name="billingCity" required>
                                            </div>
                                            <div class="form-group">
                                                <label>State</label>
                                                <select name="billingState" required>
                                                    <option value="">Select State</option>
                                                    <option value="CA">California</option>
                                                    <option value="NY">New York</option>
                                                    <option value="TX">Texas</option>
                                                    <option value="FL">Florida</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>ZIP Code</label>
                                                <input type="text" name="billingZip" required>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="checkout-actions">
                                <button class="btn-secondary" onclick="prevCheckoutStep()">Back to Cart</button>
                                <button class="btn-primary" onclick="nextCheckoutStep()">Continue to Payment</button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (checkoutStep === 3) {
                return `
                    <div class="checkout-modal">
                        <div class="checkout-header">
                            <h2>Payment Method</h2>
                            <button class="checkout-close" onclick="closeCheckout()">&times;</button>
                        </div>
                        ${progressBar}
                        <div class="checkout-content">
                            <div class="checkout-step-content">
                                <div class="payment-methods">
                                    <div class="payment-option active" data-method="card">
                                        <div class="payment-header">
                                            <input type="radio" name="paymentMethod" value="card" checked>
                                            <label>Credit or Debit Card</label>
                                            <div class="card-icons">
                                                <span class="card-icon"></span>
                                                <span class="card-icon"></span>
                                                <span class="card-icon"></span>
                                            </div>
                                        </div>
                                        <div class="payment-form">
                                            <div class="form-group">
                                                <label>Card Number</label>
                                                <input type="text" name="cardNumber" placeholder="1234 5678 9012 3456" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Cardholder Name</label>
                                                <input type="text" name="cardName" required>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group">
                                                    <label>Expiry Date</label>
                                                    <input type="text" name="expiry" placeholder="MM/YY" required>
                                                </div>
                                                <div class="form-group">
                                                    <label>CVV</label>
                                                    <input type="text" name="cvv" placeholder="123" required>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="payment-option" data-method="paypal">
                                        <div class="payment-header">
                                            <input type="radio" name="paymentMethod" value="paypal">
                                            <label>PayPal</label>
                                            <div class="paypal-logo"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="security-badges">
                                    <div class="security-badge"> SSL Secured</div>
                                    <div class="security-badge"> 256-bit Encryption</div>
                                    <div class="security-badge"> PCI Compliant</div>
                                </div>
                            </div>
                            <div class="checkout-actions">
                                <button class="btn-secondary" onclick="prevCheckoutStep()">Back to Information</button>
                                <button class="btn-primary checkout-complete" onclick="completeOrder()">
                                    Complete Order - $${(cartTotal * 1.08).toFixed(2)}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            return '';
        }
        
        // Navigation functions for checkout steps
        function nextCheckoutStep() {
            if (checkoutStep < 3) {
                checkoutStep++;
                updateCheckoutModal();
            }
        }

        function prevCheckoutStep() {
            if (checkoutStep > 1) {
                checkoutStep--;
                updateCheckoutModal();
            }
        }

        function updateCheckoutModal() {
            const modal = document.querySelector('.checkout-modal');
            if (modal) {
                modal.innerHTML = getCheckoutStepHTML().replace('<div class="checkout-modal">', '').replace('</div>', '');
            }
        }

        // Update checkout quantity
        function updateCheckoutQuantity(productId, newQuantity) {
            if (newQuantity < 1) {
                removeCheckoutItem(productId);
                return;
            }
            
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity = newQuantity;
                cartCount = cart.reduce((total, item) => total + item.quantity, 0);
                cartTotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
                
                sessionStorage.setItem('calisverse_cart', JSON.stringify(cart));
                sessionStorage.setItem('calisverse_cart_count', cartCount.toString());
                sessionStorage.setItem('calisverse_cart_total', cartTotal.toString());
                
                updateCartUI();
                updateCheckoutModal();
            }
        }

        // Remove item from checkout
        function removeCheckoutItem(productId) {
            cart = cart.filter(item => item.id !== productId);
            cartCount = cart.reduce((total, item) => total + item.quantity, 0);
            cartTotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            
            sessionStorage.setItem('calisverse_cart', JSON.stringify(cart));
            sessionStorage.setItem('calisverse_cart_count', cartCount.toString());
            sessionStorage.setItem('calisverse_cart_total', cartTotal.toString());
            
            updateCartUI();
            
            if (cart.length === 0) {
                closeCheckout();
            } else {
                updateCheckoutModal();
            }
        }

        // Complete order
        function completeOrder() {
            const orderNumber = 'CV' + Date.now().toString().slice(-6);
            
            // Show loading state
            const completeBtn = document.querySelector('.checkout-complete');
            if (completeBtn) {
                completeBtn.innerHTML = 'Processing...';
                completeBtn.disabled = true;
            }
            
            // Simulate payment processing
            setTimeout(() => {
                // Clear cart
                cart = [];
                cartCount = 0;
                cartTotal = 0;
                
                sessionStorage.removeItem('calisverse_cart');
                sessionStorage.removeItem('calisverse_cart_count');
                sessionStorage.removeItem('calisverse_cart_total');
                
                updateCartUI();
                
                // Show success confirmation
                showOrderConfirmation(orderNumber);
            }, 2000);
        }

        // Show order confirmation
        function showOrderConfirmation(orderNumber) {
            const modal = document.querySelector('.checkout-overlay');
            if (modal) {
                modal.innerHTML = `
                    <div class="checkout-modal">
                        <div class="order-confirmation">
                            <div class="success-icon"></div>
                            <h2>Order Confirmed!</h2>
                            <p>Thank you for your purchase. Your order has been successfully placed.</p>
                            
                            <div class="order-details">
                                <div class="order-number">
                                    <strong>Order Number: ${orderNumber}</strong>
                                </div>
                                <div class="order-info">
                                    <p> Confirmation email sent</p>
                                    <p> Estimated delivery: 3-5 business days</p>
                                    <p> Free shipping included</p>
                                </div>
                            </div>
                            
                            <div class="confirmation-actions">
                                <button class="btn-primary" onclick="closeCheckout()">Continue Shopping</button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Auto-close after 10 seconds
                setTimeout(() => {
                    closeCheckout();
                }, 10000);
            }
        }

        // Close checkout modal
        function closeCheckout() {
            const modal = document.querySelector('.checkout-overlay');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }
        
        // Process checkout
        function processCheckout(event) {
            event.preventDefault();
            
            // Show loading state
            const button = event.target.querySelector('.checkout-btn');
            const originalText = button.textContent;
            
            button.textContent = 'Processing...';
            button.disabled = true;
            
            // Simulate payment processing
            setTimeout(() => {
                // Clear cart
                cart = [];
                sessionStorage.removeItem('calisverse_cart');
                updateCartUI();
                
                // Show success
                alert(' Order placed successfully! Thank you for your purchase. You will receive a confirmation email shortly.');
                
                // Close modals
                closeCheckout();
                closeCart();
            }, 2000);
        }
        
        // Toggle mini cart (for mobile)
        function toggleMiniCart() {
            if (window.innerWidth <= 768) {
                showCartModal();
            }
        }
        
        // Navigation functionality
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        // Form submission
        function handleFormSubmit(event) {
            event.preventDefault();
            alert('Thank you for your message! We\'ll get back to you soon.');
            event.target.reset();
        }
        
        // Enhanced mobile touch controls
        function addTouchControls() {
            const containers = document.querySelectorAll('.product-3d-container');
            containers.forEach(container => {
                let touchStartX = 0;
                let touchStartY = 0;
                let lastTouchX = 0;
                let lastTouchY = 0;
                
                container.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    touchStartX = lastTouchX = touch.clientX;
                    touchStartY = lastTouchY = touch.clientY;
                }, { passive: false });
                
                container.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - lastTouchX;
                    const deltaY = touch.clientY - lastTouchY;
                    
                    // Simulate mouse movement for 3D interaction
                    const mouseMoveEvent = new MouseEvent('mousemove', {
                        clientX: touch.clientX,
                        clientY: touch.clientY,
                        movementX: deltaX,
                        movementY: deltaY
                    });
                    
                    container.dispatchEvent(mouseMoveEvent);
                    
                    lastTouchX = touch.clientX;
                    lastTouchY = touch.clientY;
                }, { passive: false });
            });
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                initializeViewers();
                addTouchControls();
            });
        } else {
            initializeViewers();
            addTouchControls();
        }

        // Initialize navigation and interactions after DOM is ready
        function initializeInteractions() {
            // Smooth scroll navigation
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // Add to cart functionality
            document.querySelectorAll('.btn-primary').forEach(button => {
                button.addEventListener('click', () => {
                    alert('Product added to cart! ');
                });
            });
        }

        // Initialize everything when DOM is ready
        function initializeApp() {
            console.log('Initializing CalisVerse app...');
            initializeInteractions();
            updateCartUI();
            debugCart();
            
            // Make viewCart function globally accessible
            window.viewCart = viewCart;
            console.log('viewCart function attached to window:', typeof window.viewCart);
            
            // Add event listener to checkout button
            const checkoutBtn = document.getElementById('checkout-btn');
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', function(e) {
                    console.log('Checkout button clicked via event listener!');
                    e.preventDefault();
                    viewCart();
                });
                console.log('Checkout button event listener attached');
            } else {
                console.error('Checkout button not found!');
            }
            
            // Auto-close cart modal after 5 seconds of inactivity
            let cartTimeout;
            const overlay = document.getElementById('cart-overlay');
            
            if (overlay) {
                overlay.addEventListener('mouseenter', () => {
                    clearTimeout(cartTimeout);
                });
                
                overlay.addEventListener('mouseleave', () => {
                    if (overlay.classList.contains('active')) {
                        cartTimeout = setTimeout(() => {
                            closeCart();
                        }, 5000);
                    }
                });
            }
            
            console.log('App initialization complete');
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    
    </script>
    
    <!-- Load new premium components -->
    <script src="./js/debug-asset-checker.js"></script>
    <script src="./js/igloo-animated-background.js"></script>
    <script src="js/premium-model-viewer.js"></script>
    <script src="js/premium-animated-background.js"></script>
    <script src="js/email-capture.js"></script>
    <script src="js/model-viewer-handler.js"></script>
    <script src="js/debug-asset-checker.js"></script>
    <script src="./js/3d-models-legacy.js"></script>
    
    <!-- Load existing scripts -->
    <script src="./js/fixed-cart-system.js"></script>
    <script src="./js/color-picker.js"></script>
    <script src="./js/scroll-animations.js"></script>
    <script src="./js/cart-override.js"></script>
    <script src="./js/checkout-system.js"></script>
    <script src="./js/form-handler.js"></script>
    <script src="./js/mobile-optimizer.js"></script>
</body>
</html>
